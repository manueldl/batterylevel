NAME='batterylevel'
PREFIX='/usr'
DESTDIR=''
TEMPDIR := $(shell mktemp -u --suffix .$(NAME))

all:
	@echo Nothing to build
	@echo You can execute make install now

install:
	install -Dm755 src/$(NAME).py $(DESTDIR)/$(PREFIX)/bin/$(NAME)
	install -Dm644 src/$(NAME).ini $(DESTDIR)/etc/$(NAME).ini
	install -Dm644 src/$(NAME).service $(DESTDIR)/$(PREFIX)/lib/systemd/system/$(NAME).service
	install -Dm644 src/$(NAME).timer $(DESTDIR)/$(PREFIX)/lib/systemd/system/$(NAME).timer
	install -Dm644 COPYING $(DESTDIR)/$(PREFIX)/share/licenses/$(NAME)/LICENSE
	install -Dm644 AUTHORS $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/AUTHORS
	install -Dm644 BUGS $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/BUGS
	install -Dm644 ChangeLog $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/ChangeLog
	install -Dm644 FAQ $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/FAQ
	install -Dm644 INSTALL $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/INSTALL
	install -Dm644 NEWS $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/NEWS
	install -Dm644 README $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/README
	install -Dm644 THANKS $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/THANKS
	install -Dm644 TODO $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/TODO
	install -Dm644 examples/batterylevel.ini $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/examples/batterylevel.ini
	install -Dm644 examples/batterylevel.service $(DESTDIR)/$(PREFIX)/share/doc/$(NAME)/examples/batterylevel.service

uninstall: service-down
	rm -f $(PREFIX)/bin/$(NAME)
	rm -f /etc/$(NAME).ini
	rm -f $(PREFIX)/lib/systemd/system/$(NAME).service
	rm -f $(PREFIX)/lib/systemd/system/$(NAME).timer
	rm -f $(PREFIX)/share/licenses/$(NAME)/LICENSE
	rm -rf $(PREFIX)/share/doc/$(NAME)/

clean:
	rm -f packages/pacman/$(NAME)-*.pkg.tar.xz

pacman: clean
	mkdir $(TEMPDIR)
	tar cf $(TEMPDIR)/$(NAME).tar ../$(NAME)
	cp packages/pacman/local/PKGBUILD $(TEMPDIR)/
	cd $(TEMPDIR); makepkg
	cp $(TEMPDIR)/$(NAME)-*.pkg.tar.xz .
	@echo Package done!
	@echo You can install it as root with:
	@echo pacman -U $(NAME)-*.pkg.tar.xz

pacman-remote: clean
	mkdir $(TEMPDIR)
	cp packages/pacman/git/PKGBUILD $(TEMPDIR)/
	cd $(TEMPDIR); makepkg
	cp $(TEMPDIR)/$(NAME)-*.pkg.tar.xz .
	@echo Package done!
	@echo You can install it as root with:
	@echo pacman -U $(NAME)-*.pkg.tar.xz
